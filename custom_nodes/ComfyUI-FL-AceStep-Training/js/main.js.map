{"version":3,"file":"main.js","sources":["../src/styles.ts","../src/TrainingWidget.ts","../src/main.ts"],"sourcesContent":["/**\r\n * CSS styles for ACE-Step Training widget\r\n */\r\n\r\nexport const TRAINING_WIDGET_STYLES = `\r\n  .acestep-training-widget {\r\n    --primary: #06b6d4;\r\n    --primary-glow: rgba(6, 182, 212, 0.4);\r\n    --secondary: #8b5cf6;\r\n    --success: #22c55e;\r\n    --danger: #ef4444;\r\n    --warning: #f59e0b;\r\n    --bg-dark: #0f0f12;\r\n    --bg-card: #18181b;\r\n    --bg-elevated: #1f1f23;\r\n    --border: #27272a;\r\n    --border-hover: #3f3f46;\r\n    --text-primary: #fafafa;\r\n    --text-secondary: #a1a1aa;\r\n    --text-muted: #71717a;\r\n\r\n    background: var(--bg-card);\r\n    border-radius: 12px;\r\n    border: 1px solid var(--border);\r\n    overflow: hidden;\r\n    position: relative;\r\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\r\n    color: var(--text-primary);\r\n    box-sizing: border-box;\r\n    height: 100%;\r\n    min-height: 380px;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n\r\n  .acestep-training-widget * {\r\n    box-sizing: border-box;\r\n  }\r\n\r\n  /* Header */\r\n  .acestep-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 10px 14px;\r\n    background: var(--bg-elevated);\r\n    border-bottom: 1px solid var(--border);\r\n  }\r\n\r\n  .acestep-title {\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: var(--text-primary);\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n  }\r\n\r\n  .acestep-badge {\r\n    padding: 2px 8px;\r\n    background: var(--primary);\r\n    color: white;\r\n    border-radius: 10px;\r\n    font-size: 10px;\r\n    font-weight: 500;\r\n  }\r\n\r\n  .acestep-badge.idle {\r\n    background: var(--text-muted);\r\n  }\r\n\r\n  .acestep-badge.training {\r\n    background: var(--success);\r\n    animation: pulse 2s infinite;\r\n  }\r\n\r\n  @keyframes pulse {\r\n    0%, 100% { opacity: 1; }\r\n    50% { opacity: 0.7; }\r\n  }\r\n\r\n  /* Content */\r\n  .acestep-content {\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n    padding: 14px;\r\n    gap: 14px;\r\n    overflow: hidden;\r\n  }\r\n\r\n  /* Stats Grid */\r\n  .acestep-stats {\r\n    display: grid;\r\n    grid-template-columns: repeat(3, 1fr);\r\n    gap: 10px;\r\n  }\r\n\r\n  .acestep-stat {\r\n    background: var(--bg-elevated);\r\n    border-radius: 8px;\r\n    padding: 10px;\r\n    text-align: center;\r\n  }\r\n\r\n  .acestep-stat-value {\r\n    font-size: 18px;\r\n    font-weight: 700;\r\n    color: var(--primary);\r\n  }\r\n\r\n  .acestep-stat-label {\r\n    font-size: 10px;\r\n    color: var(--text-muted);\r\n    text-transform: uppercase;\r\n    margin-top: 4px;\r\n  }\r\n\r\n  /* Progress Bar */\r\n  .acestep-progress-section {\r\n    background: var(--bg-elevated);\r\n    border-radius: 8px;\r\n    padding: 12px;\r\n  }\r\n\r\n  .acestep-progress-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    margin-bottom: 8px;\r\n  }\r\n\r\n  .acestep-progress-label {\r\n    font-size: 11px;\r\n    color: var(--text-secondary);\r\n  }\r\n\r\n  .acestep-progress-value {\r\n    font-size: 11px;\r\n    color: var(--text-primary);\r\n    font-weight: 500;\r\n  }\r\n\r\n  .acestep-progress-bar {\r\n    height: 6px;\r\n    background: var(--bg-dark);\r\n    border-radius: 3px;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .acestep-progress-fill {\r\n    height: 100%;\r\n    background: linear-gradient(90deg, var(--primary), var(--secondary));\r\n    border-radius: 3px;\r\n    transition: width 0.3s ease;\r\n    width: 0%;\r\n  }\r\n\r\n  /* Loss Chart */\r\n  .acestep-chart-section {\r\n    background: var(--bg-elevated);\r\n    border-radius: 8px;\r\n    padding: 12px;\r\n    flex: 1;\r\n    min-height: 100px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .acestep-chart-header {\r\n    font-size: 11px;\r\n    color: var(--text-secondary);\r\n    margin-bottom: 8px;\r\n  }\r\n\r\n  .acestep-chart-canvas {\r\n    width: 100%;\r\n    height: 100%;\r\n    display: block;\r\n  }\r\n\r\n  /* Status */\r\n  .acestep-status {\r\n    background: var(--bg-elevated);\r\n    border-radius: 8px;\r\n    padding: 10px 12px;\r\n    font-size: 11px;\r\n    color: var(--text-secondary);\r\n    text-align: center;\r\n    border-left: 3px solid var(--primary);\r\n  }\r\n\r\n  .acestep-status.error {\r\n    border-left-color: var(--danger);\r\n    color: var(--danger);\r\n  }\r\n\r\n  .acestep-status.success {\r\n    border-left-color: var(--success);\r\n    color: var(--success);\r\n  }\r\n\r\n  /* Audio Preview */\r\n  .acestep-audio-section {\r\n    background: var(--bg-elevated);\r\n    border-radius: 8px;\r\n    padding: 12px;\r\n  }\r\n\r\n  .acestep-audio-header {\r\n    font-size: 11px;\r\n    color: var(--text-secondary);\r\n    margin-bottom: 8px;\r\n  }\r\n\r\n  .acestep-audio-player {\r\n    width: 100%;\r\n    height: 32px;\r\n  }\r\n\r\n  .acestep-audio-label {\r\n    font-size: 10px;\r\n    color: var(--text-muted);\r\n    margin-top: 6px;\r\n  }\r\n`;\r\n","/**\r\n * Training Widget Component for ACE-Step Training\r\n */\r\n\r\nimport { TRAINING_WIDGET_STYLES } from './styles';\r\nimport type { TrainingNode, LossPoint } from './types';\r\n\r\nexport class TrainingWidget {\r\n  private node: TrainingNode;\r\n  private container: HTMLElement;\r\n  private element: HTMLElement;\r\n\r\n  // UI Elements\r\n  private badgeEl: HTMLElement | null = null;\r\n  private epochValueEl: HTMLElement | null = null;\r\n  private stepValueEl: HTMLElement | null = null;\r\n  private lossValueEl: HTMLElement | null = null;\r\n  private progressFillEl: HTMLElement | null = null;\r\n  private progressLabelEl: HTMLElement | null = null;\r\n  private statusEl: HTMLElement | null = null;\r\n  private canvasEl: HTMLCanvasElement | null = null;\r\n  private audioPlayerEl: HTMLAudioElement | null = null;\r\n  private audioLabelEl: HTMLElement | null = null;\r\n\r\n  // State\r\n  private lossHistory: LossPoint[] = [];\r\n  private isTraining: boolean = false;\r\n\r\n  // Resize handling\r\n  private resizeObserver: ResizeObserver | null = null;\r\n  private resizeTimeout: number | null = null;\r\n\r\n  constructor(options: { node: TrainingNode; container: HTMLElement }) {\r\n    this.node = options.node;\r\n    this.container = options.container;\r\n    this.element = document.createElement('div');\r\n    this.element.className = 'acestep-training-widget';\r\n\r\n    this.injectStyles();\r\n    this.createUI();\r\n    this.container.appendChild(this.element);\r\n  }\r\n\r\n  private injectStyles(): void {\r\n    const styleId = 'acestep-training-styles';\r\n    if (!document.getElementById(styleId)) {\r\n      const style = document.createElement('style');\r\n      style.id = styleId;\r\n      style.textContent = TRAINING_WIDGET_STYLES;\r\n      document.head.appendChild(style);\r\n    }\r\n  }\r\n\r\n  private createUI(): void {\r\n    this.element.innerHTML = `\r\n      <div class=\"acestep-header\">\r\n        <div class=\"acestep-title\">\r\n          <span>ACE-Step Training</span>\r\n          <span class=\"acestep-badge idle\">Idle</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"acestep-content\">\r\n        <div class=\"acestep-stats\">\r\n          <div class=\"acestep-stat\">\r\n            <div class=\"acestep-stat-value\" data-stat=\"epoch\">0/0</div>\r\n            <div class=\"acestep-stat-label\">Epoch</div>\r\n          </div>\r\n          <div class=\"acestep-stat\">\r\n            <div class=\"acestep-stat-value\" data-stat=\"step\">0</div>\r\n            <div class=\"acestep-stat-label\">Step</div>\r\n          </div>\r\n          <div class=\"acestep-stat\">\r\n            <div class=\"acestep-stat-value\" data-stat=\"loss\">-</div>\r\n            <div class=\"acestep-stat-label\">Loss</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"acestep-progress-section\">\r\n          <div class=\"acestep-progress-header\">\r\n            <span class=\"acestep-progress-label\">Training Progress</span>\r\n            <span class=\"acestep-progress-value\" data-progress-label>0%</span>\r\n          </div>\r\n          <div class=\"acestep-progress-bar\">\r\n            <div class=\"acestep-progress-fill\" data-progress-fill></div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"acestep-chart-section\">\r\n          <div class=\"acestep-chart-header\">Loss History</div>\r\n          <canvas class=\"acestep-chart-canvas\"></canvas>\r\n        </div>\r\n\r\n        <div class=\"acestep-status\">\r\n          Ready to train\r\n        </div>\r\n\r\n        <div class=\"acestep-audio-section\" style=\"display: none;\">\r\n          <div class=\"acestep-audio-header\">Validation Audio</div>\r\n          <audio class=\"acestep-audio-player\" controls></audio>\r\n          <div class=\"acestep-audio-label\">Checkpoint: -</div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Get references\r\n    this.badgeEl = this.element.querySelector('.acestep-badge');\r\n    this.epochValueEl = this.element.querySelector('[data-stat=\"epoch\"]');\r\n    this.stepValueEl = this.element.querySelector('[data-stat=\"step\"]');\r\n    this.lossValueEl = this.element.querySelector('[data-stat=\"loss\"]');\r\n    this.progressFillEl = this.element.querySelector('[data-progress-fill]');\r\n    this.progressLabelEl = this.element.querySelector('[data-progress-label]');\r\n    this.statusEl = this.element.querySelector('.acestep-status');\r\n    this.canvasEl = this.element.querySelector('.acestep-chart-canvas');\r\n    this.audioPlayerEl = this.element.querySelector('.acestep-audio-player');\r\n    this.audioLabelEl = this.element.querySelector('.acestep-audio-label');\r\n\r\n    // Set up ResizeObserver for canvas scaling - watch container, not canvas\r\n    const chartSection = this.element.querySelector('.acestep-chart-section');\r\n    if (this.canvasEl && chartSection) {\r\n      this.resizeObserver = new ResizeObserver(() => {\r\n        if (this.resizeTimeout) {\r\n          clearTimeout(this.resizeTimeout);\r\n        }\r\n        this.resizeTimeout = window.setTimeout(() => {\r\n          this.drawChart();\r\n        }, 16); // ~60fps max\r\n      });\r\n      this.resizeObserver.observe(chartSection);\r\n    }\r\n\r\n    // Draw initial chart\r\n    this.drawChart();\r\n  }\r\n\r\n  public updateProgress(\r\n    epoch: number,\r\n    totalEpochs: number,\r\n    loss: number,\r\n    step: number,\r\n    totalSteps?: number\r\n  ): void {\r\n    this.isTraining = true;\r\n\r\n    // Update badge\r\n    if (this.badgeEl) {\r\n      this.badgeEl.textContent = 'Training';\r\n      this.badgeEl.className = 'acestep-badge training';\r\n    }\r\n\r\n    // Update stats\r\n    if (this.epochValueEl) {\r\n      this.epochValueEl.textContent = `${epoch}/${totalEpochs}`;\r\n    }\r\n    if (this.stepValueEl) {\r\n      this.stepValueEl.textContent = step.toString();\r\n    }\r\n    if (this.lossValueEl) {\r\n      this.lossValueEl.textContent = loss.toFixed(6);\r\n    }\r\n\r\n    // Update progress bar\r\n    const progress = (epoch / totalEpochs) * 100;\r\n    if (this.progressFillEl) {\r\n      this.progressFillEl.style.width = `${progress}%`;\r\n    }\r\n    if (this.progressLabelEl) {\r\n      this.progressLabelEl.textContent = `${progress.toFixed(1)}%`;\r\n    }\r\n  }\r\n\r\n  public updateLossHistory(history: LossPoint[]): void {\r\n    this.lossHistory = history;\r\n    this.drawChart();\r\n  }\r\n\r\n  public updateStatus(message: string, type: 'normal' | 'error' | 'success' = 'normal'): void {\r\n    if (this.statusEl) {\r\n      this.statusEl.textContent = message;\r\n      this.statusEl.className = 'acestep-status';\r\n      if (type !== 'normal') {\r\n        this.statusEl.classList.add(type);\r\n      }\r\n    }\r\n  }\r\n\r\n  public addValidationAudio(audioBase64: string, checkpointPath: string): void {\r\n    const audioSection = this.element.querySelector('.acestep-audio-section') as HTMLElement;\r\n    if (audioSection) {\r\n      audioSection.style.display = 'block';\r\n    }\r\n\r\n    if (this.audioPlayerEl) {\r\n      this.audioPlayerEl.src = audioBase64;\r\n    }\r\n\r\n    if (this.audioLabelEl) {\r\n      this.audioLabelEl.textContent = `Checkpoint: ${checkpointPath}`;\r\n    }\r\n  }\r\n\r\n  public onTrainingComplete(finalPath: string): void {\r\n    this.isTraining = false;\r\n\r\n    if (this.badgeEl) {\r\n      this.badgeEl.textContent = 'Complete';\r\n      this.badgeEl.className = 'acestep-badge';\r\n      this.badgeEl.style.background = '#22c55e';\r\n    }\r\n\r\n    this.updateStatus(`Training complete! Saved to: ${finalPath}`, 'success');\r\n  }\r\n\r\n  public reset(): void {\r\n    this.lossHistory = [];\r\n    this.isTraining = false;\r\n\r\n    if (this.badgeEl) {\r\n      this.badgeEl.textContent = 'Training';\r\n      this.badgeEl.className = 'acestep-badge training';\r\n    }\r\n\r\n    if (this.epochValueEl) this.epochValueEl.textContent = '0/0';\r\n    if (this.stepValueEl) this.stepValueEl.textContent = '0';\r\n    if (this.lossValueEl) this.lossValueEl.textContent = '-';\r\n\r\n    if (this.progressFillEl) this.progressFillEl.style.width = '0%';\r\n    if (this.progressLabelEl) this.progressLabelEl.textContent = '0%';\r\n\r\n    this.updateStatus('Starting training...');\r\n    this.drawChart();\r\n\r\n    // Hide audio section\r\n    const audioSection = this.element.querySelector('.acestep-audio-section') as HTMLElement;\r\n    if (audioSection) {\r\n      audioSection.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  private drawChart(): void {\r\n    if (!this.canvasEl) return;\r\n\r\n    const canvas = this.canvasEl;\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    // Get actual size\r\n    const rect = canvas.getBoundingClientRect();\r\n    canvas.width = rect.width * window.devicePixelRatio;\r\n    canvas.height = rect.height * window.devicePixelRatio;\r\n    ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\r\n\r\n    const w = rect.width;\r\n    const h = rect.height;\r\n\r\n    // Clear\r\n    ctx.fillStyle = '#0f0f12';\r\n    ctx.fillRect(0, 0, w, h);\r\n\r\n    // No data message\r\n    if (this.lossHistory.length < 2) {\r\n      ctx.fillStyle = '#71717a';\r\n      ctx.font = '11px Inter, sans-serif';\r\n      ctx.textAlign = 'center';\r\n      ctx.fillText('Waiting for training data...', w / 2, h / 2);\r\n      return;\r\n    }\r\n\r\n    // Calculate scales\r\n    const padding = { top: 20, right: 20, bottom: 25, left: 50 };\r\n    const chartW = w - padding.left - padding.right;\r\n    const chartH = h - padding.top - padding.bottom;\r\n\r\n    const maxStep = Math.max(...this.lossHistory.map(d => d.step));\r\n    const minStep = Math.min(...this.lossHistory.map(d => d.step));\r\n    const maxLoss = Math.max(...this.lossHistory.map(d => d.loss));\r\n    const minLoss = Math.min(...this.lossHistory.map(d => d.loss));\r\n    const lossRange = maxLoss - minLoss || 1;\r\n\r\n    // Draw grid\r\n    ctx.strokeStyle = '#27272a';\r\n    ctx.lineWidth = 0.5;\r\n\r\n    for (let i = 0; i <= 4; i++) {\r\n      const y = padding.top + (chartH / 4) * i;\r\n      ctx.beginPath();\r\n      ctx.moveTo(padding.left, y);\r\n      ctx.lineTo(w - padding.right, y);\r\n      ctx.stroke();\r\n\r\n      // Y-axis labels\r\n      const lossVal = maxLoss - (lossRange / 4) * i;\r\n      ctx.fillStyle = '#71717a';\r\n      ctx.font = '9px Inter, sans-serif';\r\n      ctx.textAlign = 'right';\r\n      ctx.fillText(lossVal.toFixed(4), padding.left - 5, y + 3);\r\n    }\r\n\r\n    // Draw loss line\r\n    ctx.strokeStyle = '#06b6d4';\r\n    ctx.lineWidth = 2;\r\n    ctx.lineJoin = 'round';\r\n    ctx.lineCap = 'round';\r\n    ctx.beginPath();\r\n\r\n    this.lossHistory.forEach((point, i) => {\r\n      const x = padding.left + ((point.step - minStep) / (maxStep - minStep || 1)) * chartW;\r\n      const y = padding.top + chartH - ((point.loss - minLoss) / lossRange) * chartH;\r\n\r\n      if (i === 0) {\r\n        ctx.moveTo(x, y);\r\n      } else {\r\n        ctx.lineTo(x, y);\r\n      }\r\n    });\r\n\r\n    ctx.stroke();\r\n\r\n    // Draw gradient fill\r\n    const gradient = ctx.createLinearGradient(0, padding.top, 0, h - padding.bottom);\r\n    gradient.addColorStop(0, 'rgba(6, 182, 212, 0.3)');\r\n    gradient.addColorStop(1, 'rgba(6, 182, 212, 0)');\r\n\r\n    ctx.fillStyle = gradient;\r\n    ctx.beginPath();\r\n\r\n    this.lossHistory.forEach((point, i) => {\r\n      const x = padding.left + ((point.step - minStep) / (maxStep - minStep || 1)) * chartW;\r\n      const y = padding.top + chartH - ((point.loss - minLoss) / lossRange) * chartH;\r\n\r\n      if (i === 0) {\r\n        ctx.moveTo(x, y);\r\n      } else {\r\n        ctx.lineTo(x, y);\r\n      }\r\n    });\r\n\r\n    // Close the path\r\n    const lastPoint = this.lossHistory[this.lossHistory.length - 1];\r\n    const lastX = padding.left + ((lastPoint.step - minStep) / (maxStep - minStep || 1)) * chartW;\r\n    ctx.lineTo(lastX, padding.top + chartH);\r\n    ctx.lineTo(padding.left, padding.top + chartH);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    // Current loss label\r\n    ctx.fillStyle = '#fafafa';\r\n    ctx.font = 'bold 10px Inter, sans-serif';\r\n    ctx.textAlign = 'left';\r\n    ctx.fillText(`Loss: ${lastPoint.loss.toFixed(6)}`, padding.left + 5, padding.top + 12);\r\n  }\r\n\r\n  public dispose(): void {\r\n    // Clean up ResizeObserver\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.disconnect();\r\n      this.resizeObserver = null;\r\n    }\r\n    if (this.resizeTimeout) {\r\n      clearTimeout(this.resizeTimeout);\r\n      this.resizeTimeout = null;\r\n    }\r\n\r\n    if (this.element.parentNode) {\r\n      this.element.parentNode.removeChild(this.element);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * ACE-Step Training Frontend Extension\r\n *\r\n * Registers the training widget with ComfyUI and handles WebSocket events.\r\n */\r\n\r\nimport { app } from '../../../scripts/app.js';\r\nimport { api } from '../../../scripts/api.js';\r\nimport { TrainingWidget } from './TrainingWidget';\r\nimport type { TrainingNode, DOMWidget, TrainingProgressData } from './types';\r\n\r\n// Store widget instances for cleanup and updates\r\nconst widgetInstances = new Map<number, TrainingWidget>();\r\n\r\nfunction createTrainingWidget(node: TrainingNode): { widget: DOMWidget } {\r\n  // Create container element\r\n  const container = document.createElement('div');\r\n  container.id = `acestep-training-widget-${node.id}`;\r\n  container.style.width = '100%';\r\n  container.style.height = '100%';\r\n  container.style.minHeight = '280px';\r\n\r\n  // Create DOM widget using ComfyUI's API\r\n  const widget = node.addDOMWidget(\r\n    'training_ui',\r\n    'training-widget',\r\n    container,\r\n    {\r\n      getMinHeight: () => 400,\r\n      hideOnZoom: false,\r\n      serialize: false,\r\n    }\r\n  ) as DOMWidget;\r\n\r\n  // Create the actual widget after container is mounted\r\n  setTimeout(() => {\r\n    const trainingWidget = new TrainingWidget({\r\n      node,\r\n      container,\r\n    });\r\n    widgetInstances.set(node.id, trainingWidget);\r\n  }, 100);\r\n\r\n  // Cleanup when node is removed\r\n  widget.onRemove = () => {\r\n    const instance = widgetInstances.get(node.id);\r\n    if (instance) {\r\n      instance.dispose();\r\n      widgetInstances.delete(node.id);\r\n    }\r\n  };\r\n\r\n  return { widget };\r\n}\r\n\r\n// Register the extension with ComfyUI\r\napp.registerExtension({\r\n  name: 'ComfyUI.ACEStep_Training',\r\n\r\n  // Called when any node is created\r\n  nodeCreated(node: TrainingNode) {\r\n    // Only handle our specific node type\r\n    if (node.constructor?.comfyClass !== 'ACEStep_Train') {\r\n      return;\r\n    }\r\n\r\n    // Adjust default node size to accommodate the widget\r\n    const [oldWidth, oldHeight] = node.size;\r\n    node.setSize([Math.max(oldWidth, 400), Math.max(oldHeight, 600)]);\r\n\r\n    // Create the training widget\r\n    createTrainingWidget(node);\r\n  },\r\n});\r\n\r\n// Listen for custom training updates from Python\r\napi.addEventListener('acestep.training.progress', ((event: CustomEvent<TrainingProgressData>) => {\r\n  const detail = event.detail;\r\n  if (!detail?.node) return;\r\n\r\n  const nodeId = parseInt(detail.node, 10);\r\n  const widget = widgetInstances.get(nodeId);\r\n  if (!widget) return;\r\n\r\n  switch (detail.type) {\r\n    case 'progress':\r\n      widget.updateProgress(\r\n        detail.epoch ?? 0,\r\n        detail.total_epochs ?? 0,\r\n        detail.loss ?? 0,\r\n        detail.step ?? 0\r\n      );\r\n      if (detail.loss_history) {\r\n        widget.updateLossHistory(detail.loss_history);\r\n      }\r\n      break;\r\n\r\n    case 'status':\r\n      widget.updateStatus(detail.message ?? '');\r\n      break;\r\n\r\n    case 'checkpoint':\r\n      if (detail.checkpoint_path) {\r\n        widget.updateStatus(`Checkpoint saved: ${detail.checkpoint_path}`, 'success');\r\n      }\r\n      break;\r\n\r\n    case 'complete':\r\n      if (detail.final_path) {\r\n        widget.onTrainingComplete(detail.final_path);\r\n      }\r\n      break;\r\n  }\r\n}) as EventListener);\r\n\r\n// Listen for node execution results\r\napi.addEventListener('executed', ((event: CustomEvent) => {\r\n  const detail = event.detail;\r\n  if (!detail?.node || !detail?.output) return;\r\n\r\n  const nodeId = parseInt(detail.node, 10);\r\n  const widget = widgetInstances.get(nodeId);\r\n  if (!widget) return;\r\n\r\n  // Access the ui data sent from Python\r\n  const finalPath = detail.output?.final_lora_path as string[] | undefined;\r\n\r\n  if (finalPath && finalPath.length > 0) {\r\n    widget.onTrainingComplete(finalPath[0]);\r\n  }\r\n}) as EventListener);\r\n\r\n// Listen for execution start to reset the widget\r\napi.addEventListener('executing', ((event: CustomEvent) => {\r\n  const detail = event.detail;\r\n  if (!detail?.node) return;\r\n\r\n  const nodeId = parseInt(detail.node, 10);\r\n  const widget = widgetInstances.get(nodeId);\r\n  if (widget) {\r\n    widget.reset();\r\n  }\r\n}) as EventListener);\r\n\r\nexport { TrainingWidget };\r\n"],"names":[],"mappings":"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"}